<html>
<head>
<title>Close and Open Zips</title>
<link rel="icon" type="image/png" href="favicon.png"/>
<link rel="stylesheet" href="custom.css">
<script src="sweetalert2.all.min.js"></script>  
<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

<script>
var seconds = 60;
var score = 4;
function timerFunction() {
document.getElementById("startButtonArea").style.display = "none";
checkIfGameEnded2 = 0;
var timer = window.setInterval(function() {
  if(seconds < 10) {
    document.getElementById("timer").innerHTML = "0:0" + seconds;
  } else if (seconds < 60) {
    document.getElementById("timer").innerHTML = "0:" + seconds;
  }
  
  if (seconds < 1 && checkIfGameEnded1 == 0) {
  score = 0;
  document.getElementById("score").innerHTML = score;
  } else if (seconds < 1 && checkIfGameEnded1 == 1) {
  score = 1;
  document.getElementById("score").innerHTML = score;
  }  else if (seconds < 20) {
  score = 2;
  document.getElementById("score").innerHTML = score;
  } 
  else  if (seconds < 40) {
  score = 3;
  document.getElementById("score").innerHTML = score;
  }
  
  if (checkIfGameEnded2 == 1) {
   clearInterval(timer);
  if (seconds > 40) {
      Swal.fire({
  title: 'Congratulations, you completed the test in a great time! \n Your score is: ' + score,
  showDenyButton: false,
  showCancelButton: false,
  confirmButtonText: `Play Again`,
  denyButtonText: `Κλείσιμο Παραθύρου`,
  cancelButtonText: `Αρχική Σελίδα`,
}).then((result) => {
  if (result.isConfirmed) {
    location.reload();
  } else if (result.isDenied) {
 // do nothing
  } else {
  location.reload();
  }
});
  } else if (seconds > 20) {
      Swal.fire({
  title: 'Congratulations, you completed the test in a good time! \n Your score is: ' + score,
  showDenyButton: false,
  showCancelButton: false,
  confirmButtonText: `Play Again`,
  denyButtonText: `Κλείσιμο Παραθύρου`,
  cancelButtonText: `Αρχική Σελίδα`,
}).then((result) => {
  if (result.isConfirmed) {
    location.reload();
  } else if (result.isDenied) {
 // do nothing
  }  else {
  location.reload();
  }
});
  }
  else {
      Swal.fire({
  title: 'Congratulations, you completed the test! \n Your score is: ' + score,
  showDenyButton: false,
  showCancelButton: false,
  confirmButtonText: `Play Again`,
  denyButtonText: `Κλείσιμο Παραθύρου`,
  cancelButtonText: `Αρχική Σελίδα`,
}).then((result) => {
  if (result.isConfirmed) {
    location.reload();
  } else if (result.isDenied) {
 // do nothing
  }  else {
  location.reload();
  }
});
  }
  } else if (checkIfGameEnded2 == 2) {
  clearInterval(timer);
  } else { if (seconds > 0) {
     seconds--;
  } else {
     clearInterval(timer);
     checkIfGameEnded2 = 1;
    Swal.fire({
title: 'Sorry, you did not manage to complete the test... \n Your score is: ' + score,
showDenyButton: true,
showCancelButton: false,
confirmButtonText: `Play Again`,
denyButtonText: `Close Window`,
cancelButtonText: `Αρχική Σελίδα`,
}).then((result) => {
if (result.isConfirmed) {
    window.location.reload();
  } else if (result.isDenied) {
    // do nothing
  }
});
  }
  }
  }, 1000);
} 

var checkIfGameEnded1 = 0;
var checkIfGameEnded2 = 1;
  
function quit() {  
checkIfGameEnded2 = 2;
Swal.fire({
title: 'Sorry, you did not manage to complete the test...',
showDenyButton: true,
showCancelButton: false,
confirmButtonText: `Play Again`,
denyButtonText: `Close Window`,
cancelButtonText: `Αρχική Σελίδα`,
}).then((result) => {
if (result.isConfirmed) {
    window.location.reload();
  } else if (result.isDenied) {
    // do nothing
  }
});
}
</script>

<script type="module">
var checkDiktisPosDifx;
var checkDiktisPosDifx2;
 
const videoElement = document.getElementsByClassName('input_video')[0];
const canvasElement = document.getElementsByClassName('output_canvas')[0];
const canvasCtx = canvasElement.getContext('2d');

function onResults(results) {
  canvasCtx.save();
  canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
  canvasCtx.drawImage(
      results.image, 0, 0, canvasElement.width, canvasElement.height);
  if (results.multiHandLandmarks) {
    for (const landmarks of results.multiHandLandmarks) {
      drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
                     {color: '#00FF00', lineWidth: 1});
      drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 1});
    
var fermouar = document.querySelector("#fermouar");
var rafi = document.querySelector("#rafi");

var positionFermouar = fermouar.getAttribute("position");
var positionRafi = rafi.getAttribute("position");
var widthRafi = rafi.getAttribute("width");

var thesiFermouar;
var thesiRafi;
          
const hand = results.multiHandLandmarks[0];
    
  const xAntiheiras = hand[4].x; 
  const yAntiheiras = hand[4].y;
  const zAntiheiras = hand[4].z;
  
  const xDiktis = hand[8].x; 
  const yDiktis = hand[8].y;
  const zDiktis = hand[8].z;
  
    const xMesos = hand[12].x; 
  const yMesos = hand[12].y;
  const zMesos = hand[12].z;
  
    const xParamesos = hand[16].x; 
  const yParamesos = hand[16].y;
  const zParamesos = hand[16].z;
  
    const xMikro = hand[20].x; 
  const yMikro = hand[20].y;
  const zMikro = hand[20].z;
  
  var difxAntiheirasDiktis = xAntiheiras - xDiktis;
  var difyAntiheirasDiktis = yAntiheiras - yDiktis;
  
    var difxMesosDiktis = xMesos - xDiktis;
  var difyMesosDiktis = yMesos - yDiktis;
  
    var difxParamesosDiktis = xParamesos - xDiktis;
  var difyParamesosDiktis = yParamesos - yDiktis;
  
    var difxMikroDiktis = xMikro - xDiktis;
  var difyMikroDiktis = yMikro - yDiktis;
  
  var difAntiheirasDiktis = Math.sqrt(difxAntiheirasDiktis * difxAntiheirasDiktis + difyAntiheirasDiktis * difyAntiheirasDiktis);
    var difMesosDiktis = Math.sqrt(difxMesosDiktis * difxMesosDiktis + difyMesosDiktis * difyMesosDiktis);
      var difParamesosDiktis = Math.sqrt(difxParamesosDiktis * difxParamesosDiktis + difyParamesosDiktis * difyParamesosDiktis);
        var difMikroDiktis = Math.sqrt(difxMikroDiktis * difxMikroDiktis + difyMikroDiktis * difyMikroDiktis);
        
 if (checkIfGameEnded2 == 0) {
  
 if (difAntiheirasDiktis < 0.05 && difMesosDiktis > 0.05 && difParamesosDiktis > 0.05 && difMikroDiktis > 0.05) {
 drawLandmarks(canvasCtx, landmarks, {color: '#00FF00', lineWidth: 2});
 checkDiktisPosDifx = xDiktis + 0.007;
 checkDiktisPosDifx2 = xDiktis - 0.007;

if (localStorage.getItem("checkIfMove") > checkDiktisPosDifx) {
thesiFermouar = positionFermouar.x + 0.2;
} else if (localStorage.getItem("checkIfMove") < checkDiktisPosDifx2) {
thesiFermouar = positionFermouar.x - 0.2;
}

if (thesiFermouar > -1.6 && thesiFermouar < 1.6) {
document.querySelector("#fermouar").setAttribute("position", thesiFermouar + " 10 -2");
}

if (positionFermouar.x < -1.4) {
checkIfGameEnded1 = 1;
document.getElementById("perigrafi").style.display = "none";
document.getElementById("perigrafi2").style.display = "block";
  }
if (checkIfGameEnded1 == 1 && positionFermouar.x > 1.4) {
checkIfGameEnded2 = 1;
  }
}
   localStorage.setItem("checkIfMove", xDiktis);
   }
}
  }
  canvasCtx.restore();
}

const hands = new Hands({locateFile: (file) => {
  return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
}});
hands.setOptions({
  maxNumHands: 2,
  modelComplexity: 1,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});
hands.onResults(onResults);

const camera = new Camera(videoElement, {
  onFrame: async () => {
    await hands.send({image: videoElement});
  },
  width: 384,
  height: 216
});
camera.start();
  </script>
  </head>
  
  <body>
    <div class="container" style="position: absolute; left: 0; top: 0; z-index: 9999 !important;">
   <video style="display: none;" class="input_video"></video>
    <canvas class="output_canvas" width="384px" height="216px"></canvas>
  </div>
  
  <div id="quitButtonArea"><button onclick="quit();">Quit</button></div>
   <div id="scoreArea">Score - <div id="score">4</div></div>
  <div id="timerArea">Time Left - <div id="timer">1:00</div></div>
  <div id="startButtonArea"><button onclick="timerFunction();">Start Timer<br/>(be sure to open your camera first)</button></div>
  
<div id="perigrafi">Open the zip</div>
<div id="perigrafi2" style="display: none;">Close the zip</div>

    <a-scene cursor="rayOrigin:mouse">
      <a-box id="tsantaki" position="0 9 -2" width="3" height="2" depth="0.2" color="#ccc" ></a-box>
       <a-box id="rafi" position="0 10 -2" width="3" height="0.05" depth="0.05" color="#000" ></a-box>
       <a-box id="fermouar" position="1.5 10 -2" width="0.02" height="0.5" depth="0.07" color="#888" ></a-box>

<a-box id="box" position="0 8.5 -7" width="18" height="1" depth="13" color="#964B00" ></a-box>

<a-cylinder id="cylinder" position="-8 1 -12" radius="0.35" height="15" color="#964B00" ></a-cylinder>
<a-cylinder id="cylinder" position="8 1 -12" radius="0.35" height="15" color="#964B00" ></a-cylinder>

<a-cylinder id="cylinder" position="-8 1 -2" radius="0.35" height="15" color="#964B00" ></a-cylinder>
<a-cylinder id="cylinder" position="8 1 -2" radius="0.35" height="15" color="#964B00" ></a-cylinder>
      
      <a-plane  position="0 0 0" rotation="-90 0 0" width="100%" height="50%" color="#7BC8A4"></a-plane>
      <a-sky color="#87CEEB"></a-sky>

       <a-entity position="0 9 0.5">
      <a-camera id="camera" look-controls-enabled="false" keyboard-controls="mode: fps">
    </a-camera>
       
      </a-entity>
         
    </a-scene>
  </body>
</html>